{% extends 'base.html' %}

{% block content %}
<style>
    /* --- DASHBOARD STYLES --- */
    .dashboard-grid {
        display: grid;
        gap: 25px;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* 1. Status Cards Section */
    .status-cards-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }
    .status-card {
        padding: 20px;
        border-radius: 15px;
        color: white;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }
    .status-card:hover { transform: translateY(-5px); }
    .status-card h3 { margin: 0; font-size: 15px; opacity: 0.9; font-weight: 500; }
    .status-card span { font-size: 36px; font-weight: 700; margin-top: 10px; }

    /* Card Colors */
    .bg-blue { background: linear-gradient(135deg, #2d7ff9, #1a6fdc); }
    .bg-green { background: linear-gradient(135deg, #28a745, #218838); }
    .bg-yellow { background: linear-gradient(135deg, #ffc107, #e0a800); color: #333; }
    .bg-grey { background: linear-gradient(135deg, #6c757d, #545b62); }

    /* 2. Controls Section (Search) */
    .controls-card {
        background: white;
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .search-input {
        flex-grow: 1;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 10px;
        outline: none;
        font-family: inherit;
    }
    .btn-search {
        padding: 12px 25px;
        background: #6200ea;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
    }

    /* 3. Task List Section */
    .task-list-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
    .task-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        padding: 20px;
        border-radius: 20px;
        border: 1px solid white;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 150px;
    }

    .task-header h4 { margin: 0 0 5px 0; font-size: 18px; color: #2c3e50; }
    .task-desc { margin: 0; color: #7f8c8d; font-size: 14px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    .badges { margin-top: 15px; display: flex; gap: 8px; flex-wrap: wrap; }
    .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }

    /* Dynamic Badge Colors */
    .badge-High { background: #ffebee; color: #c62828; }
    .badge-Medium { background: #fff8e1; color: #f57f17; }
    .badge-Low { background: #e8f5e9; color: #2e7d32; }

    .badge-status { background: #e3f2fd; color: #1565c0; }

    .actions { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
    .btn-icon { color: #888; text-decoration: none; transition: 0.3s; }
    .btn-icon:hover { color: #6200ea; }
    .btn-icon.delete:hover { color: #ff5252; }

    /* Floating Button */
    .fab {
        position: fixed; bottom: 30px; right: 30px;
        width: 60px; height: 60px;
        background: #6200ea; color: white;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        box-shadow: 0 4px 15px rgba(98, 0, 234, 0.4);
        text-decoration: none; font-size: 30px; transition: 0.3s;
    }
    .fab:hover { transform: scale(1.1); }
</style>

<div class="dashboard-grid">

<div class="status-cards-row">

        <a href="?filter=total{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" style="text-decoration: none;">
            <div class="status-card bg-blue">
                <h3>Total</h3>
                <span>{{ total_tasks }}</span>
            </div>
        </a>

        <a href="?filter=completed{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" style="text-decoration: none;">
            <div class="status-card bg-green">
                <h3>Completed</h3>
                <span>{{ completed_count }}</span>
            </div>
        </a>

        <a href="?filter=inprogress{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" style="text-decoration: none;">
            <div class="status-card bg-yellow">
                <h3>In Progress</h3>
                <span>{{ in_progress_count }}</span>
            </div>
        </a>

        <a href="?filter=todo{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" style="text-decoration: none;">
            <div class="status-card bg-grey">
                <h3>To Do</h3>
                <span>{{ todo_count }}</span>
            </div>
        </a>

    </div>

    <div class="controls-card">
        <form method="GET" style="display: flex; width: 100%; gap: 10px;">
            <input type="text" name="search" class="search-input" placeholder="Search your tasks..." value="{{ request.GET.search }}">
            <button type="submit" class="btn-search">Search</button>
            {% if request.GET.search %}
                <a href="{% url 'index' %}" style="padding: 12px; color: #666; text-decoration: none;">Clear</a>
            {% endif %}
        </form>
    </div>

    <div class="task-list-container">
        {% for task in tasks %}
        <div class="task-card">
            <div class="task-header">
                <h4>{{ task.title }}</h4>
                {% if task.description %}
                    <p class="task-desc">{{ task.description }}</p>
                {% else %}
                    <p class="task-desc">No description added.</p>
                {% endif %}
            </div>

            <div class="badges">
                <span class="badge badge-{{ task.priority }}">{{ task.priority }}</span>
                <span class="badge badge-status">{{ task.status }}</span>
                {% if task.due_date %}
                <span class="badge" style="background: #f3f4f6; color: #555;">Due: {{ task.due_date|date:"M d" }}</span>
                {% endif %}
            </div>

            <div class="actions">
                <a href="{% url 'complete_task' task.id %}" class="btn-icon" title="Mark as Completed" style="color: #28a745; margin-right: 10px;">
        <span class="material-icons-round">check_circle</span>
    </a>
                <a href="{% url 'edit_task' task.id %}" class="btn-icon" title="Edit"><span class="material-icons-round">edit</span></a>
                <a href="{% url 'delete_task' task.id %}" class="btn-icon delete" title="Delete"><span class="material-icons-round">delete</span></a>
            </div>
        </div>
        {% empty %}
            <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #888;">
                <p>No tasks found based on your search/filter.</p>
            </div>
        {% endfor %}
    </div>

</div>

<a href="{% url 'add_task' %}" class="fab">+</a>

{% endblock %}